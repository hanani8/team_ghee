<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.js"></script>
  </head>
  <body>
    <!-- Add a svg area, empty -->
    <div id="viz"></div>

    <!-- Load DATA -->
    <script src="tree.js" type="text/javascript"></script>
    </style>

    <script>
      // Get the height and width of the current viewport
      var viewportWidth = Math.max(
        document.documentElement.clientWidth || 0,
        window.innerWidth || 0
      );
      var viewportHeight = Math.max(
        document.documentElement.clientHeight || 0,
        window.innerHeight || 0
      );

      console.log("Viewport width:", viewportWidth);
      console.log("Viewport height:", viewportHeight);

      // set the dimensions and margins of the graph
      const margin = { top: 10, right: 40, bottom: 30, left: 30 },
        width = viewportWidth - margin.left - margin.right,
        height = 8 * viewportHeight - margin.top - margin.bottom;

      d3.select("body").style("background", "#ecebdf");

      // append the svg object to the body of the page
      // let viz = d3
      //   .select("#viz")
      //   .append("svg")
      //   .attr("width", width + margin.left + margin.right)
      //   .attr("height", 10.4   * height + margin.top + margin.bottom)
      //   .append("g")
      //   .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        const root = d3.hierarchy(DATA);

        const padding = 2

        // Compute Labels and Titles
        const descendants = root.descendants()
        const L = descendants.map(d => d['data']['name'])

        // Compute the Layout
        const dx = 10
        const dy = width / (root.height + padding)
        d3.tree().nodeSize([dx, dy])(root);

          // Center the tree.
        let x0 = Infinity;
        let x1 = -x0;
        root.each(d => {
          if (d.x > x1) x1 = d.x;
          if (d.x < x0) x0 = d.x;
        });

        const svg = d3.create("svg")
      .attr("viewBox", [-dy * padding / 2, x0 - dx, width, height])
      .attr("width", width)
      .attr("height", height)
      .attr("style", "max-width: 100%; height: auto; height: intrinsic;")
      .attr("font-family", "sans-serif")
      .attr("font-size", 10);

      svg.append("g")
      .attr("fill", "none")
      .attr("stroke", "black")
    .selectAll("path")
      .data(root.links())
      .join("path")
        .attr("d", d3.linkVertical().source(d => d.source).target(d => d.target)
            .x(d => d.y)
            .y(d => d.x));

      const node = svg.append("g")
    .selectAll("a")
    .data(root.descendants())
    .join("a")
      .attr("transform", d => `translate(${d.y},${d.x})`);

      node.append("circle")
      .attr("fill", "red")
      .attr("r", 4);

      node.append("text")
      .attr("dy", "0.5em")
      .attr("x", d => d.children ? -6 : 6)
      .attr("text-anchor", d => d.children ? "end" : "start")
      .text((d, i) => L[i]);

      d3.select("#viz").node().append(svg.node());

    </script>
  </body>
</html>
